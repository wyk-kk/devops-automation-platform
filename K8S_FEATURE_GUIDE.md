# Kubernetesé›†ç¾¤ç®¡ç†åŠŸèƒ½æŒ‡å—

## ğŸ‰ æ–°åŠŸèƒ½ä»‹ç»

æœ¬æ¬¡æ›´æ–°ä¸ºè¿ç»´è‡ªåŠ¨åŒ–å¹³å°å¢åŠ äº†**Kubernetesé›†ç¾¤ç®¡ç†**åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§çš„åŠŸèƒ½æ‰©å±•ï¼Œä½¿å¹³å°èƒ½å¤Ÿç®¡ç†å®¹å™¨åŒ–åŸºç¡€è®¾æ–½ï¼

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. K8sé›†ç¾¤æ¥å…¥
- âœ… æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼š
  - **Kubeconfig**: æœ€å¸¸ç”¨çš„æ–¹å¼
  - **Token**: Bearer Tokenè®¤è¯
  - **è¯ä¹¦**: å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯
- âœ… å¤šé›†ç¾¤ç®¡ç†
- âœ… ç¯å¢ƒåˆ†ç±»ï¼ˆdev/test/staging/prodï¼‰
- âœ… è‡ªåŠ¨çŠ¶æ€æ£€æµ‹

### 2. èµ„æºç›‘æ§
- âœ… èŠ‚ç‚¹ï¼ˆNodeï¼‰ä¿¡æ¯é‡‡é›†
  - CPUã€å†…å­˜å®¹é‡
  - è¿è¡ŒçŠ¶æ€
  - Podæ•°é‡
  - ç³»ç»Ÿä¿¡æ¯
- âœ… å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ç®¡ç†
- âœ… PodçŠ¶æ€ç›‘æ§
- âœ… é›†ç¾¤èµ„æºç»Ÿè®¡

### 3. ç»Ÿä¸€èµ„æºç®¡ç†
- âœ… æœåŠ¡å™¨ + K8sé›†ç¾¤ç»Ÿä¸€è§†å›¾
- âœ… èµ„æºå¯¹æ¯”åˆ†æ
- âœ… ä¸€é”®åŒæ­¥é›†ç¾¤çŠ¶æ€

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–

#### åç«¯
```bash
cd backend
pip install kubernetes==28.1.0
```

#### å‰ç«¯
å‰ç«¯å·²åŒ…å«æ‰€éœ€ä¾èµ–ï¼ˆElement Pluså›¾æ ‡åº“ã€EChartsç­‰ï¼‰

### æ­¥éª¤2ï¼šå¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯
cd backend
python main.py

# å¯åŠ¨å‰ç«¯
cd frontend
npm run dev
```

### æ­¥éª¤3ï¼šæ·»åŠ K8sé›†ç¾¤

1. è®¿é—® http://localhost:5173
2. ç™»å½•ç³»ç»Ÿ
3. ç‚¹å‡»å·¦ä¾§èœå• **"èµ„æºç®¡ç†"**
4. ç‚¹å‡» **"æ·»åŠ K8sé›†ç¾¤"** æŒ‰é’®
5. å¡«å†™é›†ç¾¤ä¿¡æ¯

---

## ğŸ“‹ æ·»åŠ K8sé›†ç¾¤è¯¦ç»†æ­¥éª¤

### æ–¹å¼1ï¼šä½¿ç”¨Kubeconfigï¼ˆæ¨èï¼‰

#### 1.1 è·å–Kubeconfig
```bash
# æŸ¥çœ‹å½“å‰kubeconfig
cat ~/.kube/config

# æˆ–è€…ä»é›†ç¾¤è·å–
kubectl config view --raw
```

#### 1.2 å¡«å†™è¡¨å•
- **é›†ç¾¤åç§°**: ä¾‹å¦‚ `production-k8s`
- **API Server**: ä¾‹å¦‚ `https://kubernetes.example.com:6443`
- **è®¤è¯æ–¹å¼**: é€‰æ‹© `Kubeconfig`
- **Kubeconfig**: ç²˜è´´å®Œæ•´çš„kubeconfigå†…å®¹
- **ç¯å¢ƒ**: é€‰æ‹©å¯¹åº”ç¯å¢ƒï¼ˆå¦‚ `ç”Ÿäº§ç¯å¢ƒ`ï¼‰

#### 1.3 ç‚¹å‡»åˆ›å»º
ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. éªŒè¯è¿æ¥
2. è·å–Kubernetesç‰ˆæœ¬
3. ç»Ÿè®¡èŠ‚ç‚¹ã€Podã€å‘½åç©ºé—´æ•°é‡

### æ–¹å¼2ï¼šä½¿ç”¨Service Account Token

#### 2.1 åˆ›å»ºService Account
```bash
# åˆ›å»ºservice account
kubectl create serviceaccount devops-admin -n kube-system

# ç»‘å®šcluster-adminè§’è‰²
kubectl create clusterrolebinding devops-admin-binding \
  --clusterrole=cluster-admin \
  --serviceaccount=kube-system:devops-admin

# è·å–token
kubectl -n kube-system create token devops-admin
```

#### 2.2 å¡«å†™è¡¨å•
- **é›†ç¾¤åç§°**: `test-k8s`
- **API Server**: `https://k8s-api.example.com:6443`
- **è®¤è¯æ–¹å¼**: é€‰æ‹© `Token`
- **Token**: ç²˜è´´ä¸Šé¢è·å–çš„token
- **ç¯å¢ƒ**: é€‰æ‹© `æµ‹è¯•ç¯å¢ƒ`

---

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### èµ„æºç®¡ç†é¡µé¢

#### é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡
- **æœåŠ¡å™¨æ•°**: æ˜¾ç¤ºä¼ ç»ŸæœåŠ¡å™¨æ€»æ•°
- **K8sé›†ç¾¤æ•°**: æ˜¾ç¤ºKubernetesé›†ç¾¤æ€»æ•°
- **æ€»èŠ‚ç‚¹æ•°**: æœåŠ¡å™¨ + K8sèŠ‚ç‚¹æ€»å’Œ

#### Tabåˆ‡æ¢

**æœåŠ¡å™¨æ ‡ç­¾é¡µ**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰ä¼ ç»ŸæœåŠ¡å™¨
- å®æ—¶èµ„æºä½¿ç”¨ç‡ï¼ˆCPUã€å†…å­˜ï¼‰
- æ”¯æŒSSHè¿æ¥å’Œç®¡ç†

**K8sé›†ç¾¤æ ‡ç­¾é¡µ**ï¼š
- é›†ç¾¤åˆ—è¡¨
- è¿æ¥çŠ¶æ€
- èµ„æºç»Ÿè®¡ï¼ˆèŠ‚ç‚¹/Pod/å‘½åç©ºé—´ï¼‰
- æ“ä½œï¼šè¯¦æƒ…ã€åŒæ­¥ã€åˆ é™¤

### é›†ç¾¤åŒæ­¥åŠŸèƒ½

ç‚¹å‡» **"åŒæ­¥"** æŒ‰é’®åï¼Œç³»ç»Ÿä¼šï¼š
1. è¿æ¥åˆ°K8sé›†ç¾¤
2. è·å–æœ€æ–°çš„èŠ‚ç‚¹åˆ—è¡¨
3. è·å–å‘½åç©ºé—´åˆ—è¡¨
4. è·å–PodçŠ¶æ€ï¼ˆæœ€å¤š1000ä¸ªï¼‰
5. æ›´æ–°æ•°æ®åº“

**æ³¨æ„**: åŒæ­¥æ˜¯åå°ä»»åŠ¡ï¼Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿå®Œæˆã€‚

---

## ğŸ”§ API ç«¯ç‚¹

### K8sé›†ç¾¤ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/k8s/clusters` | è·å–é›†ç¾¤åˆ—è¡¨ |
| POST | `/api/k8s/clusters` | åˆ›å»ºé›†ç¾¤ |
| GET | `/api/k8s/clusters/{id}` | è·å–é›†ç¾¤è¯¦æƒ… |
| PUT | `/api/k8s/clusters/{id}` | æ›´æ–°é›†ç¾¤ |
| DELETE | `/api/k8s/clusters/{id}` | åˆ é™¤é›†ç¾¤ |
| POST | `/api/k8s/clusters/{id}/check-status` | æ£€æŸ¥è¿æ¥çŠ¶æ€ |
| POST | `/api/k8s/clusters/{id}/sync` | åŒæ­¥é›†ç¾¤èµ„æº |

### K8sèµ„æºæŸ¥è¯¢

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/k8s/clusters/{id}/nodes` | è·å–èŠ‚ç‚¹åˆ—è¡¨ |
| GET | `/api/k8s/clusters/{id}/namespaces` | è·å–å‘½åç©ºé—´ |
| GET | `/api/k8s/clusters/{id}/pods` | è·å–Podåˆ—è¡¨ |
| GET | `/api/k8s/statistics` | è·å–ç»Ÿè®¡ä¿¡æ¯ |

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### K8sClusterï¼ˆé›†ç¾¤ï¼‰
```python
- id: é›†ç¾¤ID
- name: é›†ç¾¤åç§°
- api_server: API Serveråœ°å€
- auth_type: è®¤è¯æ–¹å¼
- version: Kubernetesç‰ˆæœ¬
- node_count: èŠ‚ç‚¹æ•°
- pod_count: Podæ•°
- namespace_count: å‘½åç©ºé—´æ•°
- status: è¿æ¥çŠ¶æ€
- environment: ç¯å¢ƒç±»å‹
```

### K8sNodeï¼ˆèŠ‚ç‚¹ï¼‰
```python
- node_name: èŠ‚ç‚¹åç§°
- node_ip: èŠ‚ç‚¹IP
- status: çŠ¶æ€ï¼ˆReady/NotReadyï¼‰
- roles: è§’è‰²ï¼ˆmaster/workerï¼‰
- cpu_capacity: CPUå®¹é‡
- memory_capacity: å†…å­˜å®¹é‡
- pod_count: è¿è¡Œçš„Podæ•°
```

### K8sNamespaceï¼ˆå‘½åç©ºé—´ï¼‰
```python
- namespace_name: å‘½åç©ºé—´åç§°
- status: çŠ¶æ€
- pod_count: Podæ•°é‡
- service_count: Serviceæ•°é‡
- deployment_count: Deploymentæ•°é‡
```

### K8sPodï¼ˆPodï¼‰
```python
- pod_name: Podåç§°
- namespace: æ‰€å±å‘½åç©ºé—´
- node_name: è¿è¡ŒèŠ‚ç‚¹
- status: çŠ¶æ€
- ready_containers: å°±ç»ªå®¹å™¨æ•°
- total_containers: æ€»å®¹å™¨æ•°
- restart_count: é‡å¯æ¬¡æ•°
```

---

## ğŸ” æƒé™è¯´æ˜

### K8sé›†ç¾¤æƒé™è¦æ±‚

æ·»åŠ é›†ç¾¤æ—¶ä½¿ç”¨çš„å‡­è¯éœ€è¦ä»¥ä¸‹æƒé™ï¼š

**æœ€å°æƒé™**ï¼š
- `get`, `list`, `watch` æƒé™ç”¨äºï¼š
  - nodes
  - namespaces
  - pods
  - services
  - deployments

**æ¨èæƒé™**ï¼š
- ä½¿ç”¨ `cluster-admin` è§’è‰²ï¼ˆå®Œæ•´ç®¡ç†æƒé™ï¼‰
- æˆ–è€…åˆ›å»ºè‡ªå®šä¹‰ ClusterRoleï¼š

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: devops-reader
rules:
- apiGroups: [""]
  resources: ["nodes", "namespaces", "pods", "services"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments", "statefulsets", "daemonsets"]
  verbs: ["get", "list", "watch"]
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Kubeconfigå®‰å…¨
- âš ï¸ KubeconfigåŒ…å«æ•æ„Ÿå‡­è¯ä¿¡æ¯
- âœ… æ•°æ®åº“ä¸­å·²åŠ å¯†å­˜å‚¨
- âœ… ä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†

### 2. ç½‘ç»œè¿æ¥
- ç¡®ä¿è¿ç»´å¹³å°èƒ½å¤Ÿè®¿é—®K8s API Server
- å¦‚æœAPI Serveråœ¨å†…ç½‘ï¼Œéœ€è¦é…ç½®ç½‘ç»œè·¯ç”±
- æ”¯æŒHTTPSå’Œéæ ‡å‡†ç«¯å£

### 3. æ€§èƒ½è€ƒè™‘
- é¦–æ¬¡åŒæ­¥å¤§é›†ç¾¤å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
- Podæ•°æ®é™åˆ¶ä¸º1000æ¡ï¼ˆé¿å…æ•°æ®åº“è¿‡å¤§ï¼‰
- å»ºè®®å®šæœŸæ¸…ç†å†å²æ•°æ®

### 4. é›†ç¾¤ç‰ˆæœ¬
- æ”¯æŒKubernetes 1.19+
- æ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šè¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `è¿æ¥å¤±è´¥` æˆ– `status: disconnected`

**å¯èƒ½åŸå› **ï¼š
1. API Serveråœ°å€ä¸æ­£ç¡®
2. ç½‘ç»œä¸å¯è¾¾
3. å‡­è¯è¿‡æœŸæˆ–æ— æ•ˆ
4. è¯ä¹¦éªŒè¯å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•è¿æ¥
kubectl --kubeconfig=/path/to/config get nodes

# æ£€æŸ¥API Serveråœ°å€
kubectl cluster-info

# éªŒè¯è¯ä¹¦
openssl s_client -connect k8s-api.example.com:6443
```

### é—®é¢˜2ï¼šæƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯**: `Forbidden` æˆ– `403`

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥Service Accountæƒé™
- ç¡®è®¤ClusterRoleç»‘å®šæ­£ç¡®
- ä½¿ç”¨å…·æœ‰è¶³å¤Ÿæƒé™çš„å‡­è¯

### é—®é¢˜3ï¼šåŒæ­¥æ…¢

**ç°è±¡**: ç‚¹å‡»åŒæ­¥åé•¿æ—¶é—´æ— å“åº”

**è§£å†³æ–¹æ³•**ï¼š
- åŒæ­¥æ˜¯åå°ä»»åŠ¡ï¼Œç­‰å¾…å‡ ç§’ååˆ·æ–°é¡µé¢
- å¤§é›†ç¾¤é¦–æ¬¡åŒæ­¥å¯èƒ½éœ€è¦30ç§’ä»¥ä¸Š
- æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤è¿›åº¦

---

## ğŸ“š æ‰©å±•åŠŸèƒ½ï¼ˆæœªæ¥è®¡åˆ’ï¼‰

- [ ] Podæ—¥å¿—æŸ¥çœ‹
- [ ] å®¹å™¨ç»ˆç«¯ï¼ˆWeb Shellï¼‰
- [ ] Deploymentä¼¸ç¼©
- [ ] Serviceç®¡ç†
- [ ] ConfigMap/Secretç®¡ç†
- [ ] Helm Chartéƒ¨ç½²
- [ ] èµ„æºä½¿ç”¨ç‡å›¾è¡¨
- [ ] å‘Šè­¦è§„åˆ™æ”¯æŒK8sæŒ‡æ ‡

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå¤šé›†ç¾¤ç®¡ç†
ç®¡ç†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§å¤šä¸ªK8sé›†ç¾¤ï¼š
```
ç”Ÿäº§ç¯å¢ƒé›†ç¾¤:
  - API: https://prod-k8s.company.com:6443
  - èŠ‚ç‚¹: 10ä¸ª
  - Pod: 500+

æµ‹è¯•ç¯å¢ƒé›†ç¾¤:
  - API: https://test-k8s.company.com:6443
  - èŠ‚ç‚¹: 3ä¸ª
  - Pod: 100+
```

### åœºæ™¯2ï¼šæ··åˆåŸºç¡€è®¾æ–½
åŒæ—¶ç®¡ç†ä¼ ç»ŸæœåŠ¡å™¨å’Œå®¹å™¨åŒ–åº”ç”¨ï¼š
```
èµ„æºç®¡ç†:
  â”œâ”€â”€ ä¼ ç»ŸæœåŠ¡å™¨: 20å°
  â””â”€â”€ K8sé›†ç¾¤: 3ä¸ª
      â”œâ”€â”€ èŠ‚ç‚¹: 30ä¸ª
      â””â”€â”€ Pod: 1000+

æ€»è®¡ç®¡ç†èŠ‚ç‚¹: 50ä¸ª
```

### åœºæ™¯3ï¼šç¯å¢ƒéš”ç¦»
æŒ‰ç¯å¢ƒåˆ†ç±»ç®¡ç†ï¼š
```
å¼€å‘ç¯å¢ƒ: 2ä¸ªé›†ç¾¤
æµ‹è¯•ç¯å¢ƒ: 1ä¸ªé›†ç¾¤
é¢„å‘ç¯å¢ƒ: 1ä¸ªé›†ç¾¤
ç”Ÿäº§ç¯å¢ƒ: 3ä¸ªé›†ç¾¤
```

---

## ğŸ“ è®ºæ–‡è¦ç‚¹

### æŠ€æœ¯äº®ç‚¹
1. **å¤šé›†ç¾¤ç®¡ç†**: æ”¯æŒç®¡ç†å¤šä¸ªKubernetesé›†ç¾¤
2. **è®¤è¯é€‚é…**: æ”¯æŒå¤šç§è®¤è¯æ–¹å¼
3. **èµ„æºåŒæ­¥**: è‡ªåŠ¨åŒæ­¥é›†ç¾¤èµ„æºçŠ¶æ€
4. **ç»Ÿä¸€ç®¡ç†**: ä¼ ç»ŸæœåŠ¡å™¨+å®¹å™¨åŒ–åŸºç¡€è®¾æ–½ç»Ÿä¸€ç®¡ç†
5. **Python Kuberneteså®¢æˆ·ç«¯**: ä½¿ç”¨å®˜æ–¹Python SDK

### æ¶æ„è®¾è®¡
```
å‰ç«¯ (Vue3 + Element Plus)
    â†“
APIå±‚ (FastAPI REST)
    â†“
æœåŠ¡å±‚ (K8sService)
    â†“
K8så®¢æˆ·ç«¯ (Python kubernetesåº“)
    â†“
Kubernetesé›†ç¾¤
```

### åˆ›æ–°ç‚¹
- æ··åˆåŸºç¡€è®¾æ–½ç®¡ç†ï¼ˆè™šæ‹Ÿæœº+å®¹å™¨ï¼‰
- å¤šé›†ç¾¤ç»Ÿä¸€è§†å›¾
- å®æ—¶çŠ¶æ€åŒæ­¥
- ç¯å¢ƒåˆ†ç±»ç®¡ç†

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [Kuberneteså®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [Python Kuberneteså®¢æˆ·ç«¯](https://github.com/kubernetes-client/python)
- [è¿ç»´è‡ªåŠ¨åŒ–å¹³å°APIæ–‡æ¡£](./docs/API_DOCUMENTATION.md)

---

**ç‰ˆæœ¬**: v3.0  
**æ›´æ–°æ—¥æœŸ**: 2025-01-15  
**ä½œè€…**: è¿ç»´è‡ªåŠ¨åŒ–å¹³å°å›¢é˜Ÿ  
**é€‚ç”¨äº**: æœ¬ç§‘æ¯•ä¸šè®ºæ–‡é¡¹ç›® - Kubernetesæ‰©å±•åŠŸèƒ½

