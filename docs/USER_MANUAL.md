# 用户使用手册

## 目录

1. [快速开始](#快速开始)
2. [功能模块](#功能模块)
3. [常见场景](#常见场景)
4. [常见问题](#常见问题)

## 快速开始

### 首次登录

1. 访问系统地址: http://localhost:5173
2. 使用默认管理员账号登录:
   - 用户名: `admin`
   - 密码: `admin123`
3. 登录成功后，建议立即修改密码

### 界面介绍

系统采用左侧导航栏布局：

- **仪表盘**: 查看系统概览和统计信息
- **服务器管理**: 管理服务器资源
- **脚本管理**: 创建和执行运维脚本
- **任务调度**: 配置定时任务
- **告警管理**: 查看和处理告警信息
- **用户管理**: 管理系统用户（仅管理员）

## 功能模块

### 1. 仪表盘

仪表盘提供系统概览，包括：

- **统计卡片**: 显示服务器、脚本、任务、告警的数量统计
- **快速操作**: 快速跳转到常用功能
- **最近执行记录**: 查看最近的脚本执行情况

### 2. 服务器管理

#### 添加服务器

1. 点击"添加服务器"按钮
2. 填写服务器信息：
   - **服务器名称**: 便于识别的名称
   - **主机地址**: IP地址或域名
   - **SSH端口**: 默认22
   - **用户名**: SSH登录用户名
   - **密码**: SSH登录密码（或使用SSH密钥）
   - **描述**: 服务器用途说明
3. 点击"确定"保存

#### 测试连接

点击服务器列表中的"测试连接"按钮，系统会尝试SSH连接到服务器，验证凭证是否正确。

#### 查看服务器状态

点击"查看状态"按钮，可以实时查看服务器的：
- CPU使用率
- 内存使用率
- 磁盘使用率
- 系统运行时间

#### 编辑和删除

- **编辑**: 修改服务器配置信息
- **删除**: 从系统中移除服务器（不影响实际服务器）

### 3. 脚本管理

#### 创建脚本

1. 点击"创建脚本"按钮
2. 填写脚本信息：
   - **脚本名称**: 脚本的名称
   - **脚本类型**: Shell、Python、Bash等
   - **脚本内容**: 具体的脚本代码
   - **描述**: 脚本功能说明
3. 点击"确定"保存

**脚本示例**:

```bash
#!/bin/bash
# 系统信息检查脚本

echo "========== 系统信息 =========="
echo "主机名: $(hostname)"
echo "操作系统: $(uname -s)"
echo "内核版本: $(uname -r)"

echo ""
echo "========== CPU信息 =========="
lscpu | grep "^CPU(s):"

echo ""
echo "========== 内存信息 =========="
free -h

echo ""
echo "========== 磁盘信息 =========="
df -h
```

#### 执行脚本

1. 点击脚本列表中的"执行"按钮
2. 选择目标服务器
3. 点击"执行"开始运行

系统会：
- 将脚本上传到目标服务器
- 执行脚本
- 返回执行结果
- 保存执行记录

#### 查看执行记录

在仪表盘或脚本详情页面可以查看历史执行记录，包括：
- 执行时间
- 执行状态（成功/失败）
- 输出结果
- 错误信息

### 4. 任务调度

#### 创建定时任务

1. 点击"新建任务"按钮
2. 填写任务信息：
   - **任务名称**: 任务的名称
   - **任务类型**: 选择"脚本"或"命令"
   - **脚本/命令**: 选择要执行的脚本或输入命令
   - **目标服务器**: 选择执行任务的服务器
   - **Cron表达式**: 设置执行时间
   - **是否启用**: 开关任务
3. 点击"确定"保存

#### Cron表达式说明

Cron表达式格式: `分 时 日 月 周`

**常用示例**:
- `0 2 * * *` - 每天凌晨2点
- `0 */6 * * *` - 每6小时
- `0 0 * * 0` - 每周日凌晨
- `30 8 * * 1-5` - 工作日早上8:30
- `0 0 1 * *` - 每月1号凌晨
- `*/5 * * * *` - 每5分钟

**Cron表达式生成器**: 可以使用在线工具 https://crontab.guru/ 生成

#### 手动执行任务

即使任务已设置定时执行，也可以点击"立即执行"按钮手动触发任务。

#### 查看执行历史

点击任务详情可以查看该任务的历史执行记录。

### 5. 告警管理

#### 告警类型

系统支持以下类型的告警：
- **CPU告警**: CPU使用率超过阈值（默认80%）
- **内存告警**: 内存使用率超过阈值（默认80%）
- **磁盘告警**: 磁盘使用率超过阈值（默认80%）

#### 告警级别

- **info**: 信息
- **warning**: 警告（使用率 > 80%）
- **error**: 错误
- **critical**: 严重（使用率 > 90%）

#### 处理告警

1. **确认告警**: 表示已知晓该告警
2. **解决告警**: 表示问题已解决

#### 筛选告警

可以按状态筛选告警：
- **待处理**: 新产生的告警
- **已确认**: 已确认但未解决
- **已解决**: 已处理完成

### 6. 用户管理（仅管理员）

#### 添加用户

1. 点击"添加用户"按钮
2. 填写用户信息：
   - **用户名**: 登录用户名
   - **邮箱**: 用户邮箱
   - **密码**: 登录密码
   - **是否激活**: 用户状态
   - **是否管理员**: 赋予管理员权限
3. 点击"确定"保存

#### 权限说明

- **普通用户**: 可以管理服务器、脚本、任务，查看告警
- **管理员**: 拥有所有权限，包括用户管理

#### 编辑和删除用户

- **编辑**: 修改用户信息和权限
- **删除**: 删除用户（不能删除自己）

## 常见场景

### 场景1: 批量执行系统更新

**需求**: 定期更新所有服务器的系统包

**步骤**:
1. 创建更新脚本:
```bash
#!/bin/bash
sudo apt-get update
sudo apt-get upgrade -y
sudo apt-get autoremove -y
```

2. 添加所有需要更新的服务器

3. 创建定时任务，选择该脚本，设置Cron表达式为 `0 2 * * 0`（每周日凌晨2点）

### 场景2: 监控磁盘空间

**需求**: 每天检查磁盘使用情况并清理日志

**步骤**:
1. 创建磁盘清理脚本:
```bash
#!/bin/bash
# 显示磁盘使用情况
df -h

# 清理7天前的日志
find /var/log -name "*.log" -type f -mtime +7 -delete

echo "清理完成"
```

2. 创建定时任务，设置每天执行

### 场景3: 备份数据库

**需求**: 每天备份MySQL数据库

**步骤**:
1. 创建备份脚本:
```bash
#!/bin/bash
DATE=$(date +%Y%m%d)
BACKUP_DIR="/backup/mysql"
DB_NAME="mydb"

mkdir -p $BACKUP_DIR
mysqldump -u root -p'password' $DB_NAME > $BACKUP_DIR/${DB_NAME}_${DATE}.sql

# 保留最近30天的备份
find $BACKUP_DIR -name "*.sql" -type f -mtime +30 -delete

echo "备份完成: ${DB_NAME}_${DATE}.sql"
```

2. 创建定时任务，设置每天凌晨3点执行

### 场景4: 服务健康检查

**需求**: 定期检查关键服务是否运行

**步骤**:
1. 创建检查脚本:
```bash
#!/bin/bash
services=("nginx" "mysql" "redis")

for service in "${services[@]}"; do
    if systemctl is-active --quiet $service; then
        echo "$service: 运行中 ✓"
    else
        echo "$service: 已停止 ✗"
        systemctl start $service
    fi
done
```

2. 创建定时任务，每小时执行一次

## 常见问题

### Q1: 无法连接到服务器？

**A**: 检查以下几点：
1. 服务器IP和端口是否正确
2. SSH服务是否启动
3. 防火墙是否允许SSH连接
4. 用户名和密码是否正确
5. 如果使用SSH密钥，检查密钥格式

### Q2: 脚本执行失败？

**A**: 可能的原因：
1. 脚本语法错误
2. 缺少执行权限
3. 依赖的命令或文件不存在
4. 查看执行记录中的错误信息

### Q3: 定时任务没有执行？

**A**: 检查以下几点：
1. 任务是否已启用
2. Cron表达式是否正确
3. 服务器是否在线
4. 查看任务执行历史

### Q4: 为什么没有收到告警？

**A**: 系统当前只在数据库中记录告警，暂不支持邮件或短信通知。可以在告警管理页面查看所有告警。

### Q5: 忘记密码怎么办？

**A**: 联系管理员重置密码，或者如果有数据库访问权限，可以直接修改数据库中的密码hash。

### Q6: 如何查看脚本执行的详细输出？

**A**: 在仪表盘的"最近执行记录"或脚本详情页面，点击执行记录可以查看详细的输出和错误信息。

### Q7: 可以同时在多个服务器上执行脚本吗？

**A**: 当前版本需要为每个服务器分别执行。如需批量执行，可以创建多个任务。

### Q8: 服务器状态多久更新一次？

**A**: 服务器状态是实时查询的，每次点击"查看状态"都会获取最新数据。

### Q9: 脚本上传到服务器的哪个位置？

**A**: 脚本临时上传到 `/tmp/` 目录，执行完成后自动删除。

### Q10: 如何导出执行记录？

**A**: 当前版本暂不支持导出功能，可以通过API接口获取数据后自行导出。

## 最佳实践

1. **定期备份**: 定期备份系统数据库
2. **权限最小化**: 不要使用root用户，使用专门的运维账号
3. **脚本测试**: 新脚本先在测试服务器上验证
4. **告警处理**: 及时处理告警，避免问题积累
5. **密码安全**: 使用强密码，定期更换
6. **日志清理**: 定期清理旧的执行记录和日志
7. **文档记录**: 为重要脚本添加详细说明

## 技术支持

如有任何问题，请查阅:
- API文档: `/docs/API_DOCUMENTATION.md`
- 部署文档: `/docs/DEPLOYMENT.md`
- 在线API文档: http://localhost:8000/docs

